//загрузка параметров доступа к ФТП
PUBLIC ИмяФайла;

ИмяВременнойТаблицы = "Накладная";

ДескрипторФТП = -1;
ИмяФайла = "";
НаличиеНакладных = true;

	//соединение с ФТП
ДескрипторФТП = ФТПСОЕДИНИТЬ(_АДРЕС_ФТП_СЕРВЕРА, _ЛОГИН_ФТП, _ПАРОЛЬ_ФТП, false);

//if(ДескрипторФТП == -1 || ДескрипторФТП == 0)
//	СООБЩЕНИЕ("Ошибка при подключении к FTP серверу.", "Ошибка 1");

if(!ФТПОШИБКА(ДескрипторФТП)) 
{
	СООБЩЕНИЕ(ФТПТЕКСТОШИБКИ(ДескрипторФТП), "Ошибка при подключении к серверу.");
}
	
if(!ФТПУСТАНОВИТЬКАТАЛОГ(ДескрипторФТП, _ВХОДЯЩИЕ_ДОКУМЕНТЫ_ФТП)) // переходим в папку INBOX
{
	СООБЩЕНИЕ("На сервере не найден каталог " + _ВХОДЯЩИЕ_ДОКУМЕНТЫ_ФТП, "Ошибка 1 ");
}

//загрузка файлов с ФТП
if(!ФТППОЛУЧИТЬФАЙЛПОШАБЛОНУ(ДескрипторФТП, _ШАБЛОН_ИМЕНИ_НАКЛАДНЫХ, _ПАПКА_ДЛЯ_НАКЛАДНЫХ)) // копируем все файлы по шаблону *.xml на локальный компьютер
{
	//СООБЩЕНИЕ("В папке " + _ВХОДЯЩИЕ_ДОКУМЕНТЫ_ФТП + " не найдены файлы накладных.", "Предупреждение");
	НаличиеНакладных = false;
}
//
// Сделать дополнительную проверку перед удалением с ФТП на наличие файлов в локальной директории
//
if(!ФТПУДАЛИТЬФАЙЛ(ДескрипторФТП, _ШАБЛОН_ИМЕНИ_НАКЛАДНЫХ) && НаличиеНакладных) // после того как успешно нашли Файлы, можем смело удалять их с ФТП
{
	СООБЩЕНИЕ("Не удалось удалить файлы накладных с FTP сервера.", "Ошибка 1");
	return false;
}


if(!ФТПЗАКРЫТЬ(ДескрипторФТП)) // закрываем ФТП соединение
	СООБЩЕНИЕ("Не удалось закрыть соединение с FTP сервером.", "Предупреждение");

ИмяФайла = ФАЙЛВЫБРАТЬ(true, "Файлы накладных xml|" + _ШАБЛОН_ИМЕНИ_НАКЛАДНЫХ + "|Файлы загруженных накладных|*.downloaded", 4);
if(ИмяФайла == "" || ПУСТО(ИмяФайла))
	return false;
if(!ЗагрузитьНакладнуюЭДИ(ИмяФайла))
{
	СООБЩЕНИЕ("Ошибка при загрузке накладной.", "Ошибка 1");
	return false;
}
return ИмяВременнойТаблицы;