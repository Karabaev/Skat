FileName = "";
НомерТаблицы = ТАБЛИЦАОТКРЫТЬ(ЗАПРОС("SELECT SUSER_SNAME()") + '_TempTable');

if(НомерТаблицы < 0)
{
	СООБЩЕНИЕ("Ошибка при открытии временной таблицы.");
}

if(!ТАБЛИЦАПРИВЯЗАТЬПОЛЯ(НомерТаблицы, "*"))
{
	СООБЩЕНИЕ("Ошибка при привязке полей.");
}
if(!таблицаперейтивконец(НомерТаблицы))
{
	СООБЩЕНИЕ("Ошибка при переходе в конец.");
}

if(!ТАБЛИЦАЧИТАТЬЗАПИСЬ(НомерТаблицы))
{
	СООБЩЕНИЕ("Ошибка при чтении записи.");
}

if(FileName != "" && !ПУСТО(FileName))
{
	if(ФАЙЛПЕРЕИМЕНОВАТЬ(FileName, FileName + ".downloaded") < 1) // загруженный файл переименовываем, чтобы не мешался при следующей загрзуке, но при этом остался в качестве резервной копии
	{
		СООБЩЕНИЕ("Не удалось переименовать файл " + FileName, "Ошибка");
		return false;	
	}
	FileName = "";
	
	if(!ТАБЛИЦАОБНОВИТЬЗАПИСЬ(НомерТаблицы))
	{
		СООБЩЕНИЕ("Ошибка при обновлении записи.");
		return false;
	}
	

	return true;
}
else
{
	return true;
}